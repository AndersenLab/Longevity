---
title: "Analysis of Longevity"
author: "Ryan Abdella"
date: "January 15, 2015"
output:
  html_document:
    css: ~/Github/Food-Optimization/Scripts/Food_Optimization/Scripts/foghorn_edited.css
---


```{r, warning = F, message = F, echo = F}

library("plyr")
library("dplyr")
library("ggplot2")

experiment <- paste("p0", j, "_", k, "mgmL", sep = "")
data.loc <- paste("../Data/Raw/", experiment, "/", sep = "")
source("./wMT_fxns.R")
source(paste("./", experiment, ".R", sep = ""))

```


```{r, warning = F, message = F, echo = F}

files <- dir(path = data.loc, plateID, full.names = T)
data.df <- ldply(files, processMicrotrackerReport) %>% filter(time < 9)
data.df$day <- rep(1:(length(files)), each = nstrains * replicates * num_bins)

```

## Raw Activity

```{r Raw data, warning = F, message = F, echo = F, fig.path = paste("Scripts/", data.loc, sep = "")}

ggplot(data.df) + aes(x = day, y = activity) + geom_point() + facet_grid(row ~ col) +
  labs(x = "Time (day)", y = "Activity", title = "Raw Activity Over Time")

```


```{r, warning = F, message = F, echo = F}

combined.df <- aggregate(activity ~ row + col + day, data = data.df, sum)

```


```{r, warning = F, message = F, echo = F}

combined.df <- combined.df[order(combined.df$col, combined.df$row, combined.df$day), ]
data.df <- data.df[order(data.df$col, data.df$row, data.df$day), ]

combined.df$strain <- factor(combined.df$col, labels = strains)
data.df$strain <- factor(data.df$col, labels = strains)

```


```{r, warning = F, message = F, echo = F}

combined.df$activity[(combined.df$col %in% colRemove)] <- NA
data.df$activity[(data.df$col %in% colRemove)] <- NA

```


```{r, warning = F, message = F, echo = F}

combined.df <- combined.df %>%
  group_by(col, row) %>%
  mutate(norm.act = 100 * activity / max(activity, na.rm = T))

data.df <- data.df %>%
  group_by(col, row) %>%
  mutate(norm.act = 100 * activity / max(activity, na.rm = T))

```

## Binned Data

```{r Binned Data, warning = F, message = F, echo = F, fig.path = paste("Scripts/", data.loc, sep = "")}

ggplot(data.df) + aes(x = factor(day), y = norm.act) + ylim(0, 100) + geom_boxplot() + facet_grid(row ~ strain) +
  labs(x= "Time (day)", y = "Activity")

```

## Combined Data

```{r Combined Data, warning = F, message = F, echo = F, fig.path = paste("Scripts/", data.loc, sep = "")}

ggplot(combined.df) + aes(x = day, y = norm.act) + ylim(0, 100) + geom_point() + facet_grid(row ~ strain) +
  labs(x = "Time (day)", y = "Activity")

```


```{r, warning = F, message = F, echo = F}

gompertz <- function(input, df, row, col) {
  sum(((100 * 100 ^ ((input[1] / input[2]) * (1 - exp(input[2] * df$day[df$row == row & df$col == col])))) - df$norm.act[df$row == row & df$col == col]) ^ 2)
}

weibull <- function(input, df, row, col) {
  sum(((100 * 100 ^ (-((df$day[df$row == row & df$col == col] / input[2]) ^ input[1]))) - df$norm.act[df$row == row & df$col == col]) ^ 2)
}

twoplog <- function(input, df, row, col) {
  sum(((100 / (1 + ((df$day[df$row == row & df$col == col] / input[2]) ^ input[1]))) - df$norm.act[df$row == row & df$col == col]) ^ 2)
}

threeplog <- function(input, df, row, col) {
  sum(((100 * 100 ^ (-input[2] * df$day[df$row == row & df$col == col] - (input[2] / input[3]) * ln((input[1] - (input[2] - input[1]) * exp(-input[3] * df$day[df$row == row & df$col == col])) / input[2]))) - df$norm.act[df$row == row & df$col == col]) ^ 2)
}

twoplog2 <- formula(norm.act ~ 100/(1 + ((day / b) ^ c)))

#for (x in combined.df$row) {
 # for (y in combined.df$col) {
  #  
  #}
#}

```

```{r, warning = F, message = F, echo = F}

save(combined.df, file = paste(data.loc, "Combined_", experiment, ".Rda", sep = ""), ascii = TRUE)
save(data.df, file = paste(data.loc, "Separate_", experiment, ".Rda", sep = ""), ascii = TRUE)

```

